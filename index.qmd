---
title: "Cyclistic Bike-Share Analysis"
subtitle: "Google Data Analytics Capstone"
author: "Roberto_Antuna"
date: "2026-02-02"
format:
  html:
    toc: true
    toc-location: left
    code-fold: true
    theme: cosmo
    echo: true
editor_options: 
  chunk_output_type: console
---

## Introduction

Cyclistic is a fictional company launched in Chicago in 2016. The company specializes in providing residents with bicycles for use within the city. Currently, they have more than **5,800 bicycles** and more than **650 docking stations**.

Cyclistic offers flexible plans for utilizing their equipment:

-   Single-ride pass\
-   Full-day pass\
-   Annual membership

The first two categories are considered ***Casual riders*** (Customers according to the records), while the third category consists of ***Cyclistic members*** (Subscribers according to the records).

In addition to conventional bicycles, Cyclistic provides three inclusive options:

::: {layout-ncol="3" style="text-align: center;"}
![Image 1. Reclining Bikes](images/reclining_bike.png){fig-alt="Reclining Bike"}

![Image 2. Hand Tricycles](images/hand_tricycle.png){fig-alt="Hand Tricycle"}

![Image 3. Cargo Bikes](images/cargo_bike.png){fig-alt="Cargo Bike"}
:::

The marketing analyst team, led by Director Lily Moreno, has identified that 92% of users utilize conventional bicycles. Furthermore, 70% of users use the equipment for recreational purposes, while the remaining 30% use it as a means of transportation to work.

Given that annual memberships yield the highest profits, the marketing team aims to better understand users, their needs, and attraction channels (digital media) to **convert casual riders into Cyclistic members**.

::: {layout-ncol="1" style="text-align: center;"}
![Image 4. Cyclistic](images/cyclistic.png){fig-alt="Cyclistic logo" fig-align="center"}
:::

## 1. Ask

### Business Task

The primary objective of this analysis is to identify key differences in how annual members and casual riders utilize Cyclistic's bike-share service. By extracting these insights from historical trip data, I aim to provide data-driven recommendations for a marketing strategy specifically designed to convert casual riders into long-term annual members, thereby driving sustainable growth for the company.

### Key Stakeholders

-   **Lily Moreno:** Director of Marketing and my manager. She is responsible for the development of campaigns and initiatives to promote the bike-share program.
-   **Cyclistic Marketing Analytics Team:** A team of data analysts who are responsible for collecting, analyzing, and reporting data that helps guide Cyclistic’s marketing strategy.
-   **Cyclistic Executive Team:** The notoriously detail-oriented executive team who will decide whether to approve the recommended marketing program.

### Primary Question

To guide the marketing strategy, this report focuses on answering:\
**How do annual members and casual riders use Cyclistic bikes differently?**

### A Bonus Chapter: Real-Time Membership Offers

## 2. Prepare

### Data Sources

For this analysis, I will use Cyclistic’s historical trip data to identify trends. To ensure technical efficiency and follow project guidelines, the scope is limited to the following datasets:

**1.-** **Divvy_Trips_2019_Q1.csv**\
**2.-** **Divvy_Trips_2020_Q1.csv**

This data is public and has been made available by Motivate International Inc. under this [license](https://divvybikes.com/data-license-agreement).

### Data Credibility (ROCCC Analysis)

-   **Reliable:** The data is accurate and complete, representing a full quarter of activity for each year.
-   **Original:** The data comes directly from the City of Chicago’s bike-share program (Divvy).
-   **Comprehensive:** It includes essential variables such as ride duration, start/end times, and station names.
-   **Current:** While from 2019-2020, it provides the necessary historical context to answer the primary business question.
-   **Cited:** The data is officially documented and maintained by the service provider.

### Data Integrity & Privacy

-   **Privacy:** To protect user identity, personally identifiable information (PII) such as credit card numbers and home addresses has been excluded from the datasets.
-   **Limitations:** Demographic data (gender and age) is available for 2019 but was removed from the 2020 dataset; therefore, this analysis will focus primarily on usage patterns rather than demographics.

## 3. Process

In this phase, the data is processed to ensure it is clean, consistent, and ready for analysis. I am using **R** and the **tidyverse** ecosystem due to their efficiency in handling large datasets and ensuring reproducible results.

### 3.1 Setup and Data Import

First, I load the necessary libraries and import the datasets for the first quarter of 2019 and 2020. Following the project guidelines, the scope is focused on these specific periods to ensure technical efficiency.

```{r}
#| label: Packages
#| message: false
#| warning: false
#Import libraries
library(tidyverse)
library(lubridate)
library(janitor)
library(skimr)
library(tidytext)
```

```{r}
#| label: importing-data
# Import datasets
q1_2019 <- read_csv("data/Divvy_Trips_2019_Q1.csv", show_col_types = FALSE)
q1_2020 <- read_csv("data/Divvy_Trips_2020_Q1.csv", show_col_types = FALSE)
```

### 3.2 Data Inspection

Before any manipulation, it is essential to understand the structure and data types of the imported datasets. This step confirms the consistency of the data and identifies necessary cleaning tasks.

```{r}
#| label: inspection
# Inspect the structure of both datasets
glimpse(q1_2019)
glimpse(q1_2020)
```

### 3.3 Column Standardization

The inspection confirmed that the 2019 dataset uses a legacy naming convention (e.g., `trip_id`, `usertype`) compared to the 2020 version. To facilitate a clean merge, I am renaming the 2019 columns to align with the current standard.

```{r}
#| label: rename-columns
q1_2019 <- q1_2019 |>  
  rename(ride_id = trip_id,
        rideable_type = bikeid,
        started_at = start_time,
        ended_at = end_time,
        start_station_name = from_station_name,
        start_station_id = from_station_id,
        end_station_name = to_station_name,
        end_station_id = to_station_id,
        member_casual = usertype)
```

### 3.4 Data Consistency & Type Conversion

After renaming the columns, it is crucial to align the data types. In the 2019 dataset, `ride_id` and `rideable_type` are stored as numeric values, whereas the 2020 dataset stores them as characters. I will convert the 2019 columns to character format to ensure a seamless merge.

Additionally, I am consolidating the `member_casual` labels. The 2019 data uses "Subscriber" and "Customer," while 2020 uses "member" and "casual." I will standardize these to the current two-category format.

```{r}
#| label: type-conversion-and-recode

# Convert IDs to character for compatibility
q1_2019 <- q1_2019 |>  
  mutate(ride_id = as.character(ride_id),
        rideable_type = as.character(rideable_type)) 

# Consolidate user labels in both datasets
q1_2019 <- q1_2019 |> 
  mutate(member_casual = recode(member_casual,
                                "Subscriber" = "member",
                                "Customer" = "casual"))

q1_2020 <- q1_2020 |> 
  mutate(member_casual = recode(member_casual,
                                "Subscriber" = "member",
                                "Customer" = "casual"))
```

### 3.5 Merging Datasets

With identical column names and data types, I am stacking the datasets into a single data frame named `all_trips`. To optimize system memory, I will remove the original data frames from the environment once the merge is complete.

```{r}
#| label: merge-data
# Stack the data frames
all_trips <- bind_rows(q1_2019, q1_2020)

# Remove separate data frames to save RAM
rm(q1_2019, q1_2020)
```

### 3.6 Adding Time Metrics

To answer how users utilize the service differently, I will extract the date, month, and day of the week from the `started_at` column. Additionally, I will calculate the `ride_length` in minutes.

```{r}
#| label: time-metrics
# Ensure date labels are set to English for consistency
Sys.setlocale("LC_TIME", "English")
# Extract date components and calculate duration
all_trips <- all_trips |> 
  mutate(date = as.Date(started_at),
         month = format(as.Date(date), "%m"),
         day = format(as.Date(date), "%d"),
         year = format(as.Date(date), "%Y"),
         day_of_week = format(as.Date(date), "%A"),
         ride_length = as.numeric(difftime(ended_at, started_at, units = "mins")))

# Quick check of the new columns
head(all_trips |> select(started_at, ended_at, ride_length, day_of_week))
```

### 3.7 Data Cleaning and Validation

The final step in the process phase is to remove data that could skew the results. This includes trips with a duration of zero or less, and entries associated with administrative stations (such as "HQ QR") that do not represent actual customer trips.

```{r}
#| label: cleaning
# Filter out invalid durations and administrative station entries
all_trips <- all_trips |> 
  filter(start_station_name != "HQ QR" | is.na(start_station_name)) |> 
  filter(ride_length > 0)

# station_names validation
all_trips |> 
  group_by(start_station_id) |> 
  filter(n_distinct(start_station_name) > 1) |> 
  summarise(names = list(unique(start_station_name))) |>
  ungroup() |>
  unnest(cols = names)
```

### 3.8 Station Name Standardization

A preliminary group analysis revealed that the same physical docking station was appearing under multiple names due to administrative tags or minor naming updates (e.g., ID 208 recorded as both 'Ashland Ave' and 'Laflin St'). **Failing to consolidate these would lead to fragmented insights**, underreporting the popularity of key locations. I have programmatically unified these identities to ensure a single source of truth for location-based behavior.

```{r}
#| label: station-deep-clean
# 1. Remove temporary and special character tags
all_trips_v2 <- all_trips |> 
  mutate(across(c(start_station_name, end_station_name), 
                ~ str_remove_all(., " \\(Temp\\)| \\(\\*\\)")))

# 2. Consolidate specific ID-name mismatches based on geographic verification
all_trips_v2 <- all_trips_v2 |> 
  mutate(start_station_name = case_when(
    start_station_id == 19  ~ "Loomis St & Taylor St",
    start_station_id == 208 ~ "Ashland Ave & 21st St",
    start_station_id == 217 ~ "Racine Ave & Fulton St",
    start_station_id == 286 ~ "Franklin St & Quincy St",
    TRUE ~ start_station_name
  ),
  end_station_name = case_when(
    end_station_id == 19  ~ "Loomis St & Taylor St",
    end_station_id == 208 ~ "Ashland Ave & 21st St",
    end_station_id == 217 ~ "Racine Ave & Fulton St",
    end_station_id == 286 ~ "Franklin St & Quincy St",
    TRUE ~ end_station_name
  ))

# Final Verification: Checking if any station still has more than one name
all_trips_v2 |> 
  group_by(start_station_id) |> 
  summarise(unique_names = n_distinct(start_station_name)) |> 
  filter(unique_names > 1)
```

### 3.9 Coordinate Enrichment (Backfilling)

Since the 2019 dataset lacks geographic coordinates, I will use the `station_id` to map the latitude and longitude from the 2020 records to the 2019 ones. This ensures a consistent geographic analysis across the entire timeframe.

```{r}
#| label: coordinate-mapping

#| label: coordinate-mapping-full

# 1. Create a reference table for all unique station coordinates
station_map <- all_trips_v2 |>
  filter(!is.na(start_lat)) |>
  group_by(start_station_id) |>
  summarise(
    ref_lat = mean(start_lat, na.rm = TRUE),
    ref_lng = mean(start_lng, na.rm = TRUE),
    .groups = 'drop'
  )

# 2. Enrich both Start and End coordinates in a single flow
all_trips_v2 <- all_trips_v2 |>
  # Enrich Start Stations
  left_join(station_map, by = c("start_station_id" = "start_station_id")) |>
  mutate(
    start_lat = coalesce(start_lat, ref_lat),
    start_lng = coalesce(start_lng, ref_lng)
  ) |>
  select(-c(ref_lat, ref_lng)) |>
  # Enrich End Stations
  left_join(station_map, by = c("end_station_id" = "start_station_id")) |>
  mutate(
    end_lat = coalesce(end_lat, ref_lat),
    end_lng = coalesce(end_lng, ref_lng)
  ) |>
  select(-c(ref_lat, ref_lng))

# Remove the intermediate dataset to free up memory for analysis
rm(station_map)

# 3. Final Data Quality Verification
summary_geo <- all_trips_v2 |> 
  summarise(
    missing_start = sum(is.na(start_lat)),
    missing_end = sum(is.na(end_lat))
  )
print(summary_geo)
```

By applying this to both start and end stations, I successfully reduced the missing geographic data from 46% to less than **0.01%** of the total records.

### 3.10 Final Data Type Transformation

To ensure analytical accuracy, I am converting categorical variables—such as station IDs, months, and days—into factors. This step is crucial for maintaining the correct chronological order in visualizations and ensuring that identification numbers are not treated as mathematical values.

```{r}
#| label: final-types
# Set locale to English again just to be safe before factoring
Sys.setlocale("LC_TIME", "English")

all_trips_v2 <- all_trips_v2 |> 
  mutate(
    # IDs as characters (since they are identifications, not numbers)
    start_station_id = as.character(start_station_id),
    end_station_id = as.character(end_station_id),
    
    # Temporal variables as ordered factors
    month = factor(month, levels = c("01", "02", "03"), ordered = TRUE),
    
    day_of_week = factor(day_of_week, 
                         levels = c("Monday", "Tuesday", "Wednesday", "Thursday", 
                                    "Friday", "Saturday", "Sunday"), 
                         ordered = TRUE),
    
    # Year and User Type as factors
    year = factor(year),
    member_casual = factor(member_casual)
  )
```

### 3.11 Final Column Selection

To ensure a consistent analysis between 2019 and 2020, I have opted to remove the `gender` and `birthyear` columns. These variables were not collected in the 2020 dataset, and including them would result in an incomplete demographic profile. Additionally, the `tripduration` column from 2019 was removed in favor of the newly calculated `ride_length` variable to ensure a uniform measurement unit (minutes) across all records.

```{r}
#| label: drop-columns
# Remove inconsistent or redundant columns
all_trips_v2 <- all_trips_v2 |> 
  select(-c(gender, birthyear, tripduration))
```

### 3.12 Data Health Check & Quality Assurance

As a final step before analysis, I conducted a quality check using the `skimr` library to ensure there are no missing values in critical columns and to examine the distribution of `ride_length`.

```{r}
#| label: qa-check
# Summary of the clean dataset
skim(all_trips_v2)
```

> **Analyst Note:**\
> The `skim` output confirms a clean dataset with **788,189 observations**. While coordinates (`lat`/`lng`) show some missing values (46%), this does not impact the primary business question regarding usage patterns by membership type.

**Critical Data Note:** The `skim` analysis reveals significant outliers in `ride_length`. While the median trip is only **8.98 minutes**, the maximum value reaches an unrealistic **177,200.37 minutes** (approx. 123 days). These outliers skew the distribution, as seen in the "flat" histogram. For the subsequent analysis, I will consider these anomalies to ensure the average metrics represent true user behavior.

### 3.13 Outlier Treatment & Business Logic Validation

A critical anomaly was detected during the quality check: several trips recorded durations exceeding **100 days**. Based on **industry standards** for urban bike-sharing systems and Cyclistic's business model—focused on short-term city transit—trips lasting more than **24 hours (1,440 minutes)** are considered technical errors, thefts, or system failures rather than intentional rentals.

To ensure that descriptive statistics (like the average) reflect true user behavior, I have capped the dataset at 24 hours.

> **Note for the Operations Team:** This 24-hour threshold is a data-driven recommendation. I suggest the Cyclistic technical team validates these specific records to confirm if they represent unreturned bikes or docking station malfunctions.

```{r}
#| label: outlier-filtering
# Filtering trips to a maximum of 24 hours (1,440 minutes)
all_trips_v2 <- all_trips_v2 |> 
  filter(ride_length <= 1440)

# Remove intermediate datasets to free up memory for analysis
rm(all_trips, summary_geo)

# Verify the final dimensions of the clean dataset
print(paste("Final dimensions of the clean dataset:", paste(dim(all_trips_v2), collapse = " x ")))
```

## 4. Analyze

With a clean and consolidated dataset of **787,707 records**, I will now perform a descriptive analysis to uncover trends and patterns. The focus is on identifying how usage differs between members and casual riders.

### 4.1 General Descriptive Statistics

First, I will establish a baseline for the `ride_length` variable. As noted in the previous phase, the distribution is skewed, so comparing the mean and median is essential.

```{r}
#| label: descriptive-stats
#| tbl-cap: "Table 1. Ride Duration Summary Statistics"
# Summary statistics for ride_length (in minutes)
all_trips_v2 |> 
  summarise(
    number_of_rides = n(),
    mean_ride_length = mean(ride_length),
    median_ride_length = median(ride_length),
    max_ride_length = max(ride_length),
    min_ride_length = min(ride_length)
  ) |> 
  knitr::kable(
    col.names = c("Number of rides", "Mean", "Median", "Max", "Min"),
    align = "ccccc",
    digits = 2)
```

**Key Findings:**

-   The baseline analysis of `ride_length` reveals that the average trip duration is **13.72 minutes**, while the median is **8.98 minutes**. The significant gap between the mean and median confirms that, even after removing extreme outliers (trips \> 24 hours), the distribution remains skewed by longer occasional rides.

### 4.2 Segmented Analysis: Members vs. Casuals

The core of our task is the comparison between user types. Initial data shows a clear dominance of members in total volume (720,125 members vs. 67,582 casuals). Now, let's see how their trip durations compare.

```{r}
#| label: member-vs-casual-comparison
#| tbl-cap: "Table 2. Mean and Median Ride Duration by User Type"
# Comparing mean and median duration by user type
all_trips_v2 |> 
  group_by(member_casual) |> 
  summarise(
    number_of_rides = n(),
    mean_ride_length = mean(ride_length),
    median_ride_length = median(ride_length),
    max_ride_length = max(ride_length),
    min_ride_length = min(ride_length)
  ) |> 
  knitr::kable(
    col.names = c("User Type", "Number of rides", "Mean", "Median", "Max", "Min"),
    align = "cccccc",
    digits = 2)
```

**Key Findings:**

-   When segmenting by user type, we find a stark contrast in behavior. While annual members account for the vast majority of trips (**720,125 rides**), casual riders utilize the equipment for significantly longer periods.

-   Casual riders' median trip duration (**23.13 min**) is nearly **three times longer** than that of members (**8.47 min**). This data **provides statistical evidence to support the Marketing Team's observation** that Members use Cyclistic as a highly efficient "A-to-B" commuting tool, while Casuals view the service as a platform for leisure or sightseeing.

### 4.3 Weekly Usage Patterns

To understand when these users are most active, I analyzed the number of rides and average duration for each day of the week. This analysis is crucial for identifying routine-based versus leisure-based behaviors.

```{r}
#| label: weekday-analysis
#| tbl-cap: "Table 3. Weekly Usage Patterns: Volume and Duration"
# Summary of rides and average duration by day of week
all_trips_v2 |> 
  group_by(member_casual, day_of_week) |> 
  summarise(
    number_of_rides = n(),
    average_ride_length = mean(ride_length),
    .groups = 'drop'
  ) |> 
  knitr::kable(
    col.names = c("User Type", "Day of Week", "Number of Rides", "Avg Duration (min)"),
    align = "llcc",
    digits = 2)
```

**Key Findings:**

-   **Members (The Commuters):** Their highest volume of rides occurs during the workweek (Monday through Friday), with a noticeable decline on Saturdays and Sundays. Their average duration remains remarkably consistent throughout the week, reinforcing the idea of routine, time-sensitive trips.

-   **Casual Riders (The Leisure Seekers):** While their total volume is lower than that of members, their activity peaks during the weekend. Furthermore, their average ride duration increases significantly on Saturdays and Sundays, suggesting that their use of Cyclistic is primarily tied to recreational or non-routine activities.

### 4.4 Hourly Usage Patterns

To further differentiate user behavior, I analyzed the distribution of rides by the hour of the day. This provides insight into whether the bikes are being used for scheduled activities (like commuting) or flexible ones (like tourism).

```{r}
#| label: hourly-analysis
#| tbl-cap: "Table 4. Hourly Distribution of Rides by User Type"
# Extract the hour from the starting timestamp
all_trips_v2 <- all_trips_v2 |> 
  mutate(hour = hour(started_at))

# Summarize the number of rides per hour and user type
all_trips_v2 |> 
  group_by(member_casual, hour) |> 
  summarise(number_of_rides = n(), .groups = 'drop') |> 
  pivot_wider(names_from = member_casual, values_from = number_of_rides) |> 
  knitr::kable(
    col.names = c("Hour of Day", "Casual Rides", "Member Rides"),
    align = "ccc")
```

**Key Findings:**

-   **Members (The Commuter Spikes):** We expect to see two significant peaks in member usage: one between **7:00 AM and 9:00 AM** and another between **4:00 PM and 6:00 PM**. This "double-hump" pattern is a classic indicator of a workforce using the service for daily transit.

-   **Casual Riders (The Afternoon Curve):** Unlike members, casual riders typically show a steady increase in usage starting late morning, peaking in the **mid-afternoon (12:00 PM - 3:00 PM)**, and gradually declining. This suggests leisure activities that are not bound by strict office hours.

### 4.5 Geographic Analysis: Top Starting Stations by User Type

To validate the purpose of the trips, I have segmented the top starting stations by user type. This comparison reveals whether stations are located near commercial hubs (work-oriented) or leisure landmarks (recreation-oriented).

```{r}
#| label: top-stations-comparison-1
#| tbl-cap: "Table 5a. Top 10 Starting Stations - Casual Riders"
# Top 10 Stations for Casual Riders
top_10_casual <- all_trips_v2 |> 
  filter(member_casual == "casual") |> 
  group_by(start_station_name) |> 
  summarise(number_of_rides = n()) |> 
  arrange(desc(number_of_rides)) |> 
  head(10)

# Display Casual Table
knitr::kable(top_10_casual, col.names = c("Station Name (Casual)", "Rides"))
```

```{r}
#| label: top-stations-comparison-2
#| tbl-cap: "Table 5b. Top 10 Starting Stations - Annual Members"
# Top 10 Stations for Members
top_10_member <- all_trips_v2 |> 
  filter(member_casual == "member") |> 
  group_by(start_station_name) |> 
  summarise(number_of_rides = n()) |> 
  arrange(desc(number_of_rides)) |> 
  head(10)

# Display Member Table
knitr::kable(top_10_member, col.names = c("Station Name (Member)", "Rides"))
```

**Key Findings:**

**Analyst Note:** The geographic data reveals two distinct "worlds" within the same city:

-   **The Leisure Hub (Casuals):** The top stations for casual riders, led by **Streeter Dr & Grand Ave (2,741 rides)** and **Lake Shore Dr & Monroe St (2,727 rides)**, are located exclusively near lakefront tourist attractions, parks, and museums.

-   **The Transit Hub (Members):** In contrast, member activity is concentrated at transit-linked stations such as **Canal St & Adams St (13,797 rides)** and **Clinton St & Washington Blvd (13,434 rides)**. These stations are adjacent to major metropolitan train terminals (Union Station and Ogilvie Transportation Center), confirming that members primarily use Cyclistic for the "last mile" of their professional daily commute.

## 5. Share (Visualization)

In this phase, I transform the processed data into visual insights. These visualizations are designed to highlight the behavioral gap between casual riders and annual members, providing the marketing team with clear evidence for their strategy.

### 5.1 Average Ride Duration (The Leisure Gap)

To establish the primary difference in usage, I first compare the average `ride_length`. This "quick insight" highlights a massive gap: casual riders consistently spend more time per trip than members.

```{r}
#| label: visual-duration-comparison
#| fig-cap: "Figure 1. Comparison of average trip duration between casual riders and annual members."
# Average ride length comparison
all_trips_v2 |> 
  group_by(member_casual) |> 
  summarise(avg_duration = mean(ride_length)) |> 
  ggplot(aes(x = member_casual, y = avg_duration, fill = member_casual)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = round(avg_duration, 2)), 
            vjust = -0.5, fontface = "bold") +
  coord_cartesian(ylim = c(0, 42)) +
  theme_minimal() +
  labs(title = "Average Ride Duration: Casual vs. Member",
       subtitle = "Casual riders spend significantly more time per trip",
       x = "User Type", 
       y = "Average Duration (min)",
       caption = "Data Source: Motivate International Inc.") +
  scale_fill_manual(values = c("casual" = "#F8766D", "member" = "#00BFC4")) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.line = element_line(colour = "gray"))
```

> **Analyst Note:**\
> While the **median** ride duration of 23.13 minutes for casual riders confirms they typically ride twice as long as members (8.47 min), the **mean** of 38.38 minutes reveals a significant volume of high-duration recreational trips. This "Mean-Median Gap" is a key behavioral signal: casual riders don't just ride longer on average; they are the only segment responsible for the long-tail journeys that define Cyclistic's leisure usage.

### 5.2 User Distribution by Day (Proportional Analysis)

While members provide the bulk of the volume, a proportional analysis reveals that the **market share of casual riders expands significantly on weekends**. This highlights Saturdays and Sundays as the critical window for conversion efforts.

```{r}
#| label: visual-proportional-day
#| fig-cap: "Figure 2. Daily proportional distribution showing the increase in casual rider market share during weekends."
# Proportional usage by day of week
all_trips_v2 |>
  count(day_of_week, member_casual) |>
  group_by(day_of_week) |>
  mutate(percentage = n / sum(n)) |>
  ggplot(aes(x = day_of_week, y = percentage, fill = member_casual)) +
  geom_col(position = "fill") +
  scale_y_continuous(labels = scales::percent) +
  theme_minimal() +
  labs(title = "Proportional Distribution of User Types",
       subtitle = "Casual riders' market share doubles on weekends",
       x = "Day of Week", 
       y = "Percentage of Total Rides", fill = "User Type",
       caption = "Data Source: Motivate International Inc.") +
  scale_fill_manual(values = c("casual" = "#F8766D", "member" = "#00BFC4")) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.line = element_line(colour = "gray"))
```

> **Analyst Note:**\
> While members provide the volume baseline during the workweek, the **proportional market share of casual riders nearly doubles on weekends**. This identifies Saturdays and Sundays as the "Golden Window" for conversion-focused marketing campaigns.

### 5.3 Hourly Distribution per Day (The Commuter Pulse)

By using independent scales, we uncover distinct temporal patterns: commuter spikes for members and an afternoon climb for casuals.

```{r}
#| label: visual-hourly-distribution
#| message: false
#| fig-cap: "Figure 3. Hourly ride distribution by day of the week, highlighting commuter spikes vs. leisure curves."
#| fig-width: 12
#| fig-height: 8
# Visualizing number of rides by user type during the day, faceted by day of week
all_trips_v2 |> 
  group_by(member_casual, day_of_week, hour) |> 
  summarise(number_of_rides = n(), .groups = 'drop') |> 
  ggplot(aes(x = hour, y = number_of_rides, fill = member_casual)) +
  geom_col(position = "dodge") +
  facet_grid(member_casual ~ day_of_week, scales = "free_y") +
  theme_minimal() +
  scale_y_continuous(labels = scales::comma) +
  labs(title = "Hourly Ride Distribution by User Type",
       subtitle = "Side-by-side comparison highlights distinct commuter vs. leisure patterns",
       x = "Hour of Day (24h)", 
       y = "Number of Rides", 
       fill = "User Type",
       caption = "Data Source: Motivate International Inc."
       ) +
  scale_fill_manual(values = c("casual" = "#F8766D", "member" = "#00BFC4")) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.line = element_line(colour = "gray"),
    axis.text.x = element_text(angle = 45, hjust = 1),
    strip.text = element_text(face = "bold")
  )
```

> **Analyst Note:**\
> Members exhibit sharp spikes at **8:00 AM and 5:00 PM** on weekdays. Casual ridership, however,follows a **steady afternoon climb**, peaking between **1:00 PM and 4:00 PM**. They are *afternoon users* who could be targeted with off-peak membership.

### 5.4 Geographic Distribution (Mapping the Two Worlds)

The top 10 starting stations by User type reveal a clear "Tourist vs. Worker" split.

```{r}
#| label: visual-top-stations
#| message: false
#| fig-cap: "Figure 4. Top 10 starting stations for both user types, revealing distinct geographic preferences."
# Top 10 stations for Casuals vs Members with independent ordering
bind_rows(
  top_10_casual |> mutate(user_type = "Casual"),
  top_10_member |> mutate(user_type = "Member")
) |> 
  mutate(station_name = reorder_within(start_station_name, 
                                       number_of_rides, user_type)) |> 
  ggplot(aes(x = station_name, y = number_of_rides, fill = user_type)) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  facet_wrap(~user_type, scales = "free") +
  scale_x_reordered() + 
  theme_minimal() +
  labs(title = "Top 10 Starting Stations by User Type",
       subtitle = "Leisure landmarks for casuals vs. transit hubs for members",
       x = "Station Name", 
       y = "Number of Rides",
       caption = "Data Source: Motivate International Inc."
       ) +
  scale_fill_manual(values = c("Casual" = "#F8766D", "Member" = "#00BFC4")) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.line = element_line(colour = "gray"),
    strip.text = element_text(face = "bold")
  )
```

> **Analyst Note:**\
> Casual riders dominate lakefront landmarks like **Streeter Dr & Grand Ave**. Meanwhile, members are concentrated in transit hubs near train terminals, such as **Canal St & Adams St**, which records over **13,000 rides**.

### 5.5 Geographic Cluster Map (The Spatial Divide)

By plotting the enriched coordinates, we can visualize the "Two Chicagos". Members form dense clusters in the **central Loop and transit corridors**, while casual riders are heavily concentrated along the **lakefront and tourist landmarks**.

```{r}
#| label: visual-geographic-map-final
#| message: false
#| cache: true
#| fig-cap: "Figure 5. Spatial distribution of trip starts, reconstructing Chicago's geography through usage density."
# Geographic plot with focus on Chicago coordinates
all_trips_v2 |>
  filter(!is.na(start_lat)) |>
  filter(start_lat > 41.7 & start_lat < 42.05 & start_lng > -87.75 & start_lng < -87.55) |> 
  ggplot(aes(x = start_lng, y = start_lat, color = member_casual)) +
  geom_point(alpha = 0.1, size = 0.5) + 
  facet_wrap(~member_casual) +
  theme_void() + 
  labs(title = "Geographic Usage Clusters in Chicago",
       subtitle = "Spatial divide: Casuals (Lakefront) vs Members (Loop/Transit) ",
       caption = "Data Source: Motivate International Inc.",
       color = "User Type") +
  scale_color_manual(values = c("casual" = "#F8766D", "member" = "#00BFC4")) +
  guides(color = guide_legend(override.aes = list(alpha = 1, size = 3)))
```

::: map-container
<iframe src="https://www.google.com/maps/d/u/0/embed?mid=1nD8INEDXijpqi46qh8JIxTnFKQ34oHg&amp;ehbc=2E312F" width="640" height="480">

</iframe>
:::

> **Analyst Note:**\
> The visual evidence is conclusive. When comparing the data clusters to the functional city map, we find that **Casual riders** are geographically "locked" to leisure corridors like **Navy Pier (Streeter Dr & Grand Ave)** and the **Museum Campus (Shedd Aquarium)**. Conversely, **Members** are concentrated in the city’s "nervous system"—the transit hubs near **Union and Ogilvie Stations (e.g., Canal St & Adams St)** that facilitate the daily professional commute.

## 6. Act (Recommendations)

The following strategic recommendations are designed to convert casual riders into annual members by addressing the specific behavioral and geographic gaps identified in this analysis.

### 6.1 Localized "Leisure Corridor" Campaigns

The geographic analysis reveals that casual riders are heavily concentrated along the lakefront, specifically at landmarks such as **Streeter Dr & Grand Ave (Navy Pier)** and the **Shedd Aquarium**.

-   **Recommendation:** Deploy targeted marketing efforts (digital geo-fencing and physical signage) exclusively at these high-traffic leisure hubs rather than a city-wide campaign. Highlighting the long-term savings for recreational riders in these specific locations will yield higher conversion rates.

### 6.2 The "Weekend Warrior" Membership Tier

Casual ridership share doubles on weekends, with average trip duration's reaching nearly 40 minutes. This suggests that casual users perceive the service as a primary recreational activity rather than a daily tool.

-   **Recommendation:** Introduce a seasonal "Weekend Explorer" membership. By showcasing that the cost of two 40-minute weekend trips is equivalent to a monthly pass, Cyclistic can bridge the gap for users who do not yet require a full annual commute-focused membership.

### 6.3 Off-Peak Afternoon Incentives

Through independent hourly scaling, we discovered that casual riders exhibit a strong, steady climb in activity during the afternoon (1:00 PM – 4:00 PM), peaking while members are at work.

-   **Recommendation:** Implement an "Afternoon Member" discount. Targeting casual riders who consistently use the system during these off-peak hours with a specialized membership rate can increase system efficiency and revenue without contributing to the existing 5:00 PM member rush.

## Bonus Chapter: Predictive Modeling for Conversion — From Casual Insights to Real-Time Membership Offers

In this final section, I elevate the analysis from descriptive visualization to predictive strategy. While previous sections established "what" happened, this chapter focuses on **identifying high-value leads** to optimize marketing ROI. By combining **K-means Clustering** and **Logistic Regression**, I created a framework to target three specific personas with personalized offers.

### The Strategy: Lead Scoring & Segmentation

The goal is to move away from broad campaigns and instead trigger specific offers based on real-time trip behavior. By analyzing variables such as trip duration (accounting for the mean-median gap), time of day, and location, we can categorize casual riders into high-propensity segments.

#### Target Personas for Personalized Offers:

-   **The Afternoon Specialist:** Users peaking between 1:00 PM and 4:00 PM on weekdays. They receive the **"Afternoon Membership"** discount.

-   **The Weekend Explorer:** High-duration riders (often exceeding the 23-minute median) clustered around the lakefront. They are targeted for the **"Weekend Explorer"** pass.

-   **The Shadow Commuter:** Users riding during rush hours (8:00 AM / 5:00 PM) near transit hubs like Union Station. These are high-priority leads for the **Full Annual Membership**.

#### Feature Engineering: Creating Behavioral Signals

To prepare our data for the K-means algorithm, we must convert categorical and time-based data into numerical features. This process allows the model to "see" the patterns of our three target personas.

```{r}
#| label: bonus-feature-engineering
#| message: false

# 1. Create the model-ready dataframe
model_ready_df <- all_trips_v2 |>
  # Focus exclusively on casual riders for conversion targeting
  filter(member_casual == "casual") |> 
  mutate(
    # Signal: Afternoon Specialist (1 PM - 4 PM)
    is_afternoon_user = ifelse(hour >= 13 & hour <= 16, 1, 0),
    # Signal: Shadow Commuter (Rush Hours + Transit Hubs)
    is_rush_hour = ifelse(hour %in% c(7, 8, 9, 16, 17, 18), 1, 0),
    is_transit_hub = ifelse(start_station_name %in%
                              top_10_member$start_station_name, 1, 0),
    # Signal: Weekend Explorer (Weekends + Leisure Zones)
    is_weekend = ifelse(day_of_week %in% c("Saturday", "Sunday"), 1, 0),
    is_leisure_zone = ifelse(start_station_name %in%
                               top_10_casual$start_station_name, 1, 0),
    # Normalize duration skewness using log-transformation
    log_duration = log(ride_length + 1)
  ) |>
  # Select numerical features for scaling and clustering
  select(ride_id, is_afternoon_user, is_rush_hour, is_transit_hub, 
         is_weekend, is_leisure_zone, log_duration) |>
  drop_na()
```

### Stage 1: Behavioral Clustering (Persona Discovery)

Using **K-means Clustering**, I segmented the casual rider population to find groups that share common usage patterns. This stage allows us to uncover the "Shadow Commuters" who are currently paying casual rates for a member-like routine.

```{r}
#| label: bonus-clustering-execution
#| message: false
#| warning: false

# Standardizing features for K-means
cluster_data <- model_ready_df |> 
  select(-ride_id) |>
  scale()

# Executing Clustering for 3 archetypes
set.seed(123)
bike_clusters <- kmeans(cluster_data, centers = 3, nstart = 25)

# Adding cluster assignments to the dataset
model_ready_df$persona_group <- as.factor(bike_clusters$cluster)
```

### Stage 2: Segment Validation (Persona Profiles)

After executing the K-means algorithm, I analyze the centroids of each cluster to ensure the mathematical groupings align with the intended business personas. This validation is critical to confirm that our features (Time, Geography, and Duration) successfully separated the users.

```{r}
#| label: bonus-cluster-profiles
#| tbl-cap: "Table 6. Behavioral Profiles of Identified Casual User Clusters"
#| message: false

# Calculate characteristic means per cluster
cluster_profiles <- model_ready_df |>
  group_by(persona_group) |>
  summarise(
    total_trips = n(),
    avg_afternoon = mean(is_afternoon_user),
    avg_rush_hour = mean(is_rush_hour),
    avg_weekend = mean(is_weekend),
    avg_leisure = mean(is_leisure_zone),
    # Reverting log duration to real minutes for business interpretation
    typical_duration_min = exp(mean(log_duration)) - 1
  ) |>
  arrange(desc(total_trips))

knitr::kable(cluster_profiles, 
             digits = 3,
             align = "ccccccc",
             col.names = c("Cluster", "Total Trips", "Afternoon Avg.", 
                           "Rush Hour Avg.", "Weekend Avg.", 
                           "Leisure Zone Avg.", "Typical Duration (min)"))
```

> **Analyst Note:**\
> The clustering algorithm successfully isolated our primary targets with high precision. **Cluster 1** is a perfect match for the **Afternoon Specialist** persona, showing a 100% afternoon usage rate. **Cluster 3**, while smaller in volume, captures the **Shadow Commuters** who exhibit the highest rush-hour frequency, making them the most cost-effective segment to convert into full annual members.

### Stage 3: Conversion Propensity Modeling (Lead Scoring)

Now that we have validated the segments, I apply a **Logistic Regression** model to determine the conversion probability for each casual trip. Instead of a binary "yes/no," this provides a **Propensity Score** between 0 and 1, allowing the Marketing team to prioritize leads based on their behavioral similarity to annual members.

```{r}
#| label: bonus-logistic-regression
#| message: false

# 1. Assign names to clusters for better interpretation
model_ready_df <- model_ready_df |>
  mutate(persona_name = case_when(
    persona_group == 1 ~ "Afternoon Specialist",
    persona_group == 2 ~ "General Leisure",
    persona_group == 3 ~ "Shadow Commuter"
  ))

# 2. Train a simplified Logistic Regression model
# We use the existing behavioral features to predict the persona type
log_model <- glm(is_rush_hour ~ log_duration + is_transit_hub + is_weekend, 
                 data = model_ready_df, family = "binomial")

# 3. Generate Propensity Scores
model_ready_df$propensity_score <- predict(log_model, type = "response")
```

### Stage 4: Model Evaluation & Business Logic Validation

To ensure our targeting strategy is reliable, I evaluated the Logistic Regression model using a labeled **Confusion Matrix** and a **Heatmap**. This allows us to assess how well the model identifies "Shadow Commuters" versus general leisure rides.

```{r}
#| label: bonus-model-metrics
#| tbl-cap: "Table 7. Programmatic Model Performance Metrics"
#| message: false

# 1. Generate predictions and confusion matrix
evaluation_data <- model_ready_df |>
  mutate(
    prediction = ifelse(propensity_score > 0.5, 1, 0)
  )

conf_matrix <- table(Actual = evaluation_data$is_rush_hour, 
                     Predicted = evaluation_data$prediction)

# 2. Programmatically extract metrics for reproducibility

accuracy_val <- (conf_matrix[2, 2] + conf_matrix[1, 1]) / sum(conf_matrix)
sensitivity_val <- conf_matrix[2, 2] / (conf_matrix[2, 2] + conf_matrix[2, 1])
specificity_val <- conf_matrix[1, 1] / (conf_matrix[1, 1] + conf_matrix[1, 2])

# 3. Automated metrics table
metrics_summary <- data.frame(
  Metric = c("Accuracy", "Sensitivity (Recall)", "Specificity"),
  Value = c(accuracy_val, sensitivity_val, specificity_val)
)

knitr::kable(metrics_summary, digits = 4, align = "lc")
```

```{r}
#| label: bonus-confusion-heatmap
#| fig-cap: "Figure 6. Confusion Matrix Heatmap: Identifying Shadow Commuters"
#| message: false

# Transform the matrix for ggplot visualization
conf_df <- as.data.frame(conf_matrix)
colnames(conf_df) <- c("Actual", "Predicted", "Freq")

# Apply business labels
conf_df <- conf_df |>
  mutate(
    Actual = ifelse(Actual == 1, "Shadow Commuter", "General Rider"),
    Predicted = ifelse(Predicted == 1, "Shadow Commuter", "General Rider")
  )

# Plotting the Heatmap
ggplot(conf_df, aes(x = Predicted, y = Actual, fill = Freq)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "#e3f2fd", high = "#1976d2") +
  geom_text(aes(label = Freq), color = "black", size = 5) +
  labs(title = "Model Precision Analysis",
       x = "Model Prediction",
       y = "Actual Behavior") +
  theme_minimal() +
  theme(legend.position = "none")
```

> **Analyst Note:**\
> The heatmap’s high **Specificity (0.9866)** serves as a precision filter for our high-stakes campaigns. Rather than "ignoring" tourists, the model ensures we don't overwhelm recreational riders with **irrelevant** annual membership offers. This allows for a tiered marketing strategy: the 807 high-propensity "Shadow Commuters" receive an aggressive annual pass promotion, while the identified "General Riders" are funneled into **Specialized Offers** like the Weekend Explorer or Afternoon Member passes, maximizing conversion across all segments.

### Stage 5: Model Deployment & Strategic Implementation

The final phase involves extracting the model's coefficients to create a "Propensity Engine". By including statistical confidence intervals (Uncertainty), we provide Cyclistic with a robust recipe for real-time user targeting.

```{r}
#| label: bonus-model-deployment-1
#| message: false
#| tbl-cap: "Table 8. Logistic Regression Coefficients and Deployment Recipe"

# Extracting coefficients with Confidence Intervals for senior rigor
model_stats <- as.data.frame(summary(log_model)$coefficients)
conf_intervals <- as.data.frame(confint(log_model)) 

final_recipe <- cbind(model_stats[,1:2], conf_intervals)
colnames(final_recipe) <- c("Estimate", "Std. Error", "2.5% (Lower)", "97.5% (Upper)")

knitr::kable(final_recipe, digits = 4)
```

```{r}
#| label: bonus-model-deployment-2
#| message: false
#| eval: false
# Saving the RDS files
saveRDS(log_model, "data/shadow_commuter_model.rds")
saveRDS(bike_clusters, "data/behavioral_clusters.rds")
cluster_params <- list(
  centers = bike_clusters$centers,
  scaling_center = attr(cluster_data, "scaled:center"),
  scaling_scale = attr(cluster_data, "scaled:scale")
)
saveRDS(cluster_params, "data/clustering_params.rds")
```

> **Analyst Note:**\
> The model identifies **Transit Hubs** as the strongest positive predictor for conversion (Estimate: 0.3772). **Recommendation:** Marketing efforts should not only be digital but physical. Deploying QR-code based conversion offers at top member stations (like Union Station) will catch "Shadow Commuters" exactly when their behavior mirrors that of a subscriber.

### Data Export for Business Intelligence (Tableau)

To ensure the insights from this analysis are actionable for the broader marketing and executive teams, I have developed a **Consolidated Master Dataset**. This file integrates descriptive trip data with the behavioral clusters and propensity scores generated in the previous chapters.

```{r}
#| label: final-export-and-cleanup-1
#| message: false
# 1. Create the Master Dataset for Tableau
tableau_export <- all_trips_v2 |>
  left_join(
    model_ready_df |> select(ride_id, propensity_score, persona_name),
    by = "ride_id"
  )
```

```{r}
#| label: final-export-and-cleanup-2
#| message: false
#| eval: false
# 2. Export the final Master CSV file (Approx. 787k observations)
write.csv(tableau_export, "data/cyclistic_final_strategy_data.csv", row.names = FALSE)
```

```{r}
#| label: final-export-and-cleanup-3
#| message: false
#| results: hide
# 3. TOTAL ENVIRONMENT CLEANUP (Reclaiming > 1GB of RAM)
# This step ensures that the final rendering of the Executive Summary and 
# concluding remarks remains stable and performance-efficient.
rm(all_trips_v2, model_ready_df, evaluation_data, log_model, 
   bike_clusters, cluster_profiles, tableau_export, conf_df, 
   final_recipe, metrics_summary, top_10_casual, top_10_member, cluster_data)

# Force system garbage collection
gc()
```

## Executive Summary: Data-Driven Strategy for Cyclistic’s Growth

The goal of this analysis was to design a strategic roadmap to convert casual riders into annual members by identifying behavioral patterns that signal high conversion propensity. By analyzing over 780,000 trips from the dataset, I transitioned from descriptive insights to a predictive "Lead Scoring" framework designed to maximize marketing ROI.

### Key Findings

-   **The "Shadow Commuter" Opportunity:** Analysis revealed a specific segment of 3,665 casual trips that mirror member behavior, peaking during rush hours (8 AM/5 PM) near transit hubs. These riders are currently paying premium casual rates for a routine that justifies an annual membership.

-   **Temporal Specialization:** A massive "Afternoon Specialist" segment was identified, consisting of 28,819 trips occurring exclusively between 1:00 PM and 4:00 PM on weekdays. This group represents a untapped market for a specialized mid-day membership.

-   **Duration & Location Gap:** Casual riders typically ride for 23 minutes (median), significantly longer than the 12-minute member average, especially near leisure zones like the Lakefront. This confirms that casual usage is primarily recreational but predictable.

### Strategic Recommendations

1.  **Deploy the Propensity Engine (V1.0):** Implement the Logistic Regression model to score casual trips in real-time, focusing on the 807 high-probability leads identified with **98.6% specificity**.

2.  **Model Refinement (V2.0):** To enhance precision, future iterations will incorporate **"Efficiency Signals"** (trips \< 12 minutes) and **"Pattern Validation"**. Users should only be targeted after a pattern of 3+ high-propensity trips is established to avoid "marketing fatigue" from isolated events.

3.  **Tiered Product Launch:** Create the **"Afternoon Member"** and **"Weekend Explorer"** passes to capture the high-volume segments that do not fit the traditional 9-to-5 commute profile.

4.  **Hub-Centric Marketing:** Prioritize physical and digital ads at **Transit Hubs**, as location was proven to be a top statistical predictor for membership potential (Estimate: 0.3772).

### Conclusion

By shifting from broad campaigns to a tiered, behavior-based targeting system, Cyclistic can optimize its marketing spend and accelerate the transition of high-value casual riders into loyal annual members, ensuring sustainable long-term revenue growth.
